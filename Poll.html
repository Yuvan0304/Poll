<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Inter-House Poll</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#eef3fb;
    --card:#ffffff;
    --accent:#f7dcb0;
    --accent-border:#f0a63a;
    --green:#2fb871;
    --blue:#2d86ff;
    --red:#eb4343;
    --yellow:#f0a000;
    --muted:#6b7280;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{background:linear-gradient(180deg,var(--bg) 0%, #f7fbff 100%);display:flex;align-items:center;justify-content:center;padding:28px;}
  .wrap{width:100%;max-width:420px;margin:0 auto;}
  .card{
    background:var(--card);
    border-radius:18px;
    box-shadow:0 18px 40px rgba(18,38,63,0.08);
    padding:26px;
  }
  h1{font-size:34px;margin:0 0 6px 0;font-weight:800;color:#111827;}
  p.lead{margin:0 0 18px 0;color:var(--muted);font-size:15px;}
  .note{
    background:linear-gradient(180deg,#fff6e8,#fff0d6);
    border-left:6px solid var(--accent-border);
    padding:14px 14px;
    border-radius:12px;
    margin-bottom:18px;
    color:#5a4633;
    box-shadow: 0 8px 18px rgba(240,166,58,0.08);
  }
  .subtitle{color:var(--muted);text-align:center;margin:12px 0 18px;}
  .btn{
    width:100%;
    border-radius:12px;
    padding:14px 16px;
    margin:10px 0;
    font-weight:700;
    font-size:16px;
    color:#fff;
    border:none;
    cursor:pointer;
    box-shadow:0 10px 24px rgba(16,24,40,0.06);
  }
  .btn-green{background:var(--green);}
  .btn-blue{background:var(--blue);}
  .btn-red{background:var(--red);}
  .btn-yellow{background:var(--yellow); color:#111;}
  .votes{margin-top:18px;color:var(--muted);display:flex;align-items:center;justify-content:space-between;font-size:14px}
  .results{margin-top:14px;border-radius:12px;padding:12px;background:#fafafa;border:1px solid rgba(16,24,40,0.03);}
  .result-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px dashed rgba(16,24,40,0.04);}
  .result-row:last-child{border-bottom:0;}
  .bar{height:10px;border-radius:8px;background:rgba(0,0,0,0.06);overflow:hidden;margin-left:12px;flex:1;}
  .bar > i{display:block;height:100%;background:linear-gradient(90deg, rgba(0,0,0,0.12), rgba(0,0,0,0.05));}
  .footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
  .row{display:flex;gap:12px;align-items:center}
  @media (max-width:420px){
    body{padding:18px;}
    h1{font-size:28px}
    .card{padding:20px;border-radius:16px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main" aria-labelledby="title">
      <h1 id="title">Inter-House Poll</h1>
      <p class="lead">Which House Display did you like the best?</p>

      <div class="note" id="note">Vote for the House Display you liked best — not your child’s house.</div>

      <p class="subtitle">Choose your favourite house below:</p>

      <button class="btn btn-green" data-option="Green">Green House (Mithila)</button>
      <button class="btn btn-blue" data-option="Blue">Blue House (Nalanda)</button>
      <button class="btn btn-red" data-option="Red">Red House (Takshashila)</button>
      <button class="btn btn-yellow" data-option="Yellow">Yellow House (Vikramshila)</button>

      <div class="votes">
        <div id="votesText">Votes: 0</div>
        <button id="refreshBtn" style="background:#2563eb;color:#fff;border-radius:10px;padding:6px 10px;border:none;cursor:pointer">Refresh</button>
      </div>

      <div class="results" id="resultsArea" aria-live="polite" style="display:none;">
        <!-- result rows inserted here -->
      </div>

      <div class="footer">Made by the students — Your Team</div>
    </div>
  </div>

<script type="module">
  /***********************************************
   *  FIREBASE CONFIG - PASTE YOUR CONFIG OBJECT
   ***********************************************/
  // Replace the empty object below with your web app firebaseConfig
  // Example:
  // const firebaseConfig = {
  //   apiKey: "ABC",
  //   authDomain: "your-project.firebaseapp.com",
  //   databaseURL: "https://your-project-default-rtdb.firebaseio.com",
  //   projectId: "your-project",
  //   storageBucket: "your-project.appspot.com",
  //   messagingSenderId: "...",
  //   appId: "1:...:web:..."
  // };
  const firebaseConfig = {
    apiKey: "AIzaSyBRxGX2ySr1gwNP2I728IGXwTWzBTxGGlk",
    authDomain: "poll-ysr.firebaseapp.com",
    databaseURL: "https://poll-ysr-default-rtdb.firebaseio.com/",
    projectId: "poll-ysr",
    storageBucket: "poll-ysr.firebasestorage.app",
    messagingSenderId: "724261938489",
    appId: "1:724261938489:web:7d8f908dc8ade2698b74e8"
  };

  // If firebaseConfig.databaseURL is missing, add it in project settings -> Realtime Database -> location -> the URL appears like:
  // https://<project-id>-default-rtdb.firebaseio.com/

  // If user didn't paste config, disable DB actions but UI still works locally.
  const hasConfig = firebaseConfig && firebaseConfig.apiKey;

  // Simple DOM refs
  const buttons = document.querySelectorAll('.btn');
  const votesText = document.getElementById('votesText');
  const resultsArea = document.getElementById('resultsArea');
  const refreshBtn = document.getElementById('refreshBtn');

  let db = null;
  if(hasConfig){
    // import firebase modules dynamically
    import('https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js').then(({ initializeApp })=>{
      import('https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js').then(({ getDatabase, ref, push, onValue, set, child, get })=>{
        const app = initializeApp(firebaseConfig);
        db = getDatabase(app);
        setupRealtimeListeners();
      });
    });
  } else {
    console.warn('Firebase config not provided. Add firebaseConfig in the file to enable DB.');
  }

  // helper to create default options structure if missing
  async function ensureOptionsInit(){
    if(!db) return;
    const r = ref(db, 'poll/options');
    // we will attempt to set options only if empty (non-destructive)
    // (If DB empty, set initial options)
    import('https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js').then(({ get, set })=>{
      // simplified: we'll use get via fetch on REST if needed, but this demo uses onValue listener
    });
  }

  function updateLocalResults(data){
    // data: {Green: 2, Blue:1, ...}
    const keys = ['Green','Blue','Red','Yellow'];
    let total = 0;
    keys.forEach(k=> total += (data && data[k]) ? Number(data[k]) : 0);
    votesText.textContent = 'Votes: ' + total;

    // build result rows
    resultsArea.innerHTML = '';
    keys.forEach(key=>{
      const count = (data && data[key]) ? Number(data[key]) : 0;
      const percent = total ? Math.round((count/total)*100) : 0;
      const row = document.createElement('div');
      row.className = 'result-row';
      row.innerHTML = `
        <div style="min-width:120px">${key}</div>
        <div style="display:flex;align-items:center;gap:8px;flex:1">
          <div class="bar" aria-hidden><i style="width:${percent}%"></i></div>
          <div style="min-width:48px;text-align:right">${count} (${percent}%)</div>
        </div>`;
      resultsArea.appendChild(row);
    });
    resultsArea.style.display = 'block';
  }

  // Click handlers: write vote to DB
  buttons.forEach(b=>{
    b.addEventListener('click', async (e)=>{
      const opt = b.getAttribute('data-option');
      if(!db){
        alert('Firebase not configured — votes will not be saved. Paste firebaseConfig in the file and redeploy.');
        return;
      }
      // Use transaction-like increment
      const { ref, runTransaction } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js');
      const keyRef = ref(db, 'poll/counts/' + opt);
      runTransaction(keyRef, (current)=>{
        return (current || 0) + 1;
      }).then(()=> {
        // optional local feedback
        b.animate([{ transform:'translateY(-2px)'},{ transform:'translateY(0)'}],{duration:120});
      }).catch(err=>{
        console.error('Vote failed',err);
      });
    });
  });

  // Setup listener to update UI when DB changes
  async function setupRealtimeListeners(){
    if(!db) return;
    const { ref, onValue } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js');
    const countsRef = ref(db, 'poll/counts');
    onValue(countsRef, (snapshot)=>{
      updateLocalResults(snapshot.val() || {});
    }, (err)=> console.error(err));
  }

  // manual refresh (reads current snapshot)
  refreshBtn.addEventListener('click', async ()=>{
    if(!db){ alert('Firebase not configured.'); return; }
    const { ref, get, child } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js');
    const dbRef = ref(db);
    get(child(dbRef, 'poll/counts')).then(snap=>{
      updateLocalResults(snap.val() || {});
    }).catch(err=> console.error(err));
  });

  // initial local empty results
  updateLocalResults({});
</script>
</body>
</html>
